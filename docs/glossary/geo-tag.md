# Гео-метка

==TODO: finalize==

Идея - использовать оракулов (просто набор доверенных серверов).

Гео-метку должен передавать клиент. Валидатор не может использовать айпи для определения гео - это обработка персональных данных. Для публичного блокчейна недопустимо. Более того, валидатор даже не видит всех айпи узлов - транзакцию по узлам A и B передает только один из узлов, либо вообще третий узел C.

Но если метку передает клиент - как ему доверять? Решение - оракул. Это публично доступный сервис, которому доверяет вся система. Список оракулов можно держать в основном блокчейне. Оракул выдает клиенту гео метку (код страны, дата выдачи, публичный ключ устройства) и подписывает ее своим ключем.

Оракул использует айпи для определения гео. Код оракула открыт. Все верят, что он не сохраняет айпи и не использует его не по назначению. Если пользователь не верит оракулу, либо по какой-то другой причине не хочет публиковать свой гео, он может отключить гео метки. Любые платные сервисы с разделением цены по гео должны корректно обрабатывать аккаунты без гео метки (как правило, это будет максимально дорогой тариф).

*Такую схему легко обойти с помощью VPN - подключился в "дешевую" страну, получил гео-метку и пользуешься ей.*

Есть такой вариант - оракул добавляет в метку хэш айпи. При просмотре контента, который требует наличие гео-метки, каждый узел должен отослать свою гео-метку другой стороне. Другая сторона проверяет метку - хэш айпи должен совпасть с хэшем в метке, затем проверяет подпись оракула. Таким образом клиенты на третьем уровне контролируют друг друга, не используя при этом айпи для определения гео. Нужно сделать исключение для адресов интранета - в локальной сети клиенты будут видеть не тот айпи, который подписал оракул. В других случаях при несовпадении хэша в метке и айпи узел должен разрывать соединение и сообщать другой стороне о причине ошибки (либо не разрывать соединение, а просто продолжить без гео-метки, если это позволяет контекст). Другая сторона должна попробовать обновить гео-метку. Помимо локальной сети очень сложно представить конфигурацию сети, в которой выход в мир на оракула покажет один адрес, а коннект в мир к узлу - другой. Также такая схема не будет работать, если использовать луковичную маршрутизацию. Но использовать любые сервисы с гео-привязкой в контексте tor-подобной сети - это в любом случае нонсенс. Если узел включил tor, то он всегда работает без гео-метки.